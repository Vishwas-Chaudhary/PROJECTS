<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRYPTXFER - Secure Encrypted File Transfer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Quicksand:wght@400;700&display=swap" rel="stylesheet">

</head>
<body>

    <!-- Royal Decorative SVG Background Layer -->
    <div class="royal-bg-decor" aria-hidden="true">
      <!-- Large faint fleur-de-lis -->
      <svg class="bg-fleur" width="220" height="220" viewBox="0 0 220 220" fill="none" style="top:10vh;left:5vw;"><text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" font-size="200" fill="#d4af3722">&#9884;</text></svg>
      <svg class="bg-crown" width="180" height="120" viewBox="0 0 180 120" fill="none" style="top:60vh;left:60vw;"><text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" font-size="110" fill="#d4af3720">&#9819;</text></svg>
      <!-- Scrollwork (simple path) -->
      <svg class="bg-scroll" width="320" height="80" viewBox="0 0 320 80" fill="none" style="top:35vh;left:50vw;"><path d="M10,40 Q160,0 310,40 Q160,80 10,40 Z" fill="#bfa17711"/></svg>
      <svg class="bg-fleur" width="120" height="120" viewBox="0 0 120 120" fill="none" style="top:80vh;left:10vw;"><text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle" font-size="100" fill="#d4af3715">&#9884;</text></svg>
    </div>
    <header class="vintage-header fade-in">
  <span class="royal-symbol" title="Royal Fleur-de-lis">&#9884;</span>
  <div class="vintage-badge"><span class="royal-symbol" title="Royal Crown">&#9819;</span> CRYPTXFER <span class="royal-symbol" title="Royal Crown">&#9819;</span></div>
  <div class="vintage-subtitle">Secure Encrypted File Transfer <span class="royal-symbol" title="Royal Fleur-de-lis">&#9884;</span></div>
</head>
<body>
  <div id="floating-btns" style="position:fixed;top:18px;right:32px;display:flex;flex-direction:column;gap:18px;z-index:2000;">
    <button id="theme-toggle" title="Toggle dark/light theme" style="width:48px;height:48px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;background:rgba(255,255,255,0.15);border:none;border-radius:50%;padding:0;cursor:pointer;box-shadow:0 0 12px 2px #d4af3755,0 2px 8px #d4af3733;transition:background 0.2s,box-shadow 0.2s;">
      <span id="theme-icon">&#9788;</span>
    </button>
    <button id="music-toggle" title="Toggle music" style="width:48px;height:48px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;background:rgba(255,255,255,0.15);border:none;border-radius:50%;padding:0;cursor:pointer;box-shadow:0 0 12px 2px #d4af3755,0 2px 8px #d4af3733;transition:background 0.2s,box-shadow 0.2s;">
      <span id="music-icon">&#127925;</span>
    </button>
    <button id="next-track-btn" title="Next track" style="width:48px;height:48px;display:flex;align-items:center;justify-content:center;font-size:1.8rem;background:rgba(255,255,255,0.15);border:none;border-radius:50%;padding:0;cursor:pointer;box-shadow:0 0 12px 2px #d4af3755,0 2px 8px #d4af3733;transition:background 0.2s,box-shadow 0.2s;">
      <span id="next-track-icon">&#9193;</span>
    </button>
  </div>

  <audio id="bg-music" preload="auto" autoplay></audio>
</header>
    <main style="position:relative;">
  <!-- Left royal vertical line with glowing fleur-de-lis -->
  <div class="royal-side-decor left">
    <svg width="42" height="540" viewBox="0 0 42 540" fill="none" style="display:block;">
      <defs>
        <linearGradient id="side-gold" x1="0" y1="0" x2="0" y2="540" gradientUnits="userSpaceOnUse">
          <stop stop-color="#d4af37"/>
          <stop offset="1" stop-color="#bfa177"/>
        </linearGradient>
        <filter id="glow" x="-20" y="-20" width="82" height="580" filterUnits="userSpaceOnUse">
          <feGaussianBlur stdDeviation="8" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>
      <rect x="19" y="30" width="4" height="480" rx="2" fill="url(#side-gold)" filter="url(#glow)"/>
      <text x="21" y="38" text-anchor="middle" font-size="32" fill="#d4af37" filter="url(#glow)">&#9884;</text>
      <text x="21" y="502" text-anchor="middle" font-size="32" fill="#d4af37" filter="url(#glow)" transform="rotate(180 21 502)">&#9884;</text>
    </svg>
  </div>
  <!-- End left decor -->

      <!-- Centered, straight royal divider with fleur-de-lis -->
      <div class="royal-divider fade-in" aria-hidden="true">
        <svg width="420" height="32" viewBox="0 0 420 32" fill="none">
          <defs>
            <linearGradient id="gold-gradient" x1="0" y1="0" x2="420" y2="0" gradientUnits="userSpaceOnUse">
              <stop stop-color="#d4af37"/>
              <stop offset="1" stop-color="#bfa177"/>
            </linearGradient>
          </defs>
          <line x1="30" y1="16" x2="190" y2="16" stroke="url(#gold-gradient)" stroke-width="4" stroke-linecap="round"/>
          <line x1="230" y1="16" x2="390" y2="16" stroke="url(#gold-gradient)" stroke-width="4" stroke-linecap="round"/>
          <circle cx="210" cy="16" r="12" fill="#fffbe9" stroke="url(#gold-gradient)" stroke-width="3"/>
          <text x="210" y="22" text-anchor="middle" font-size="22" fill="#d4af37" style="filter: drop-shadow(0 2px 4px #bfa17788);">&#9884;</text>
          <circle cx="200" cy="16" r="2.5" fill="#d4af37"/>
          <circle cx="220" cy="16" r="2.5" fill="#d4af37"/>
        </svg>
      </div>
        <section id="upload-section" class="fade-in">
    <div class="vintage-badge" style="font-size:1.3rem;margin-bottom:1em;">UPLOAD & ENCRYPT</div>
    <div id="drag-drop-area" tabindex="0">
        <span>Drag & drop your file here<br><span style="font-size:0.9em;opacity:0.7;">or click to select</span></span>
        <input type="file" id="upload-file" style="display:none;" />
    </div>
    <form id="upload-form">
        <label for="upload-passphrase">Passphrase (used to encrypt file):</label>
        <input type="password" id="upload-passphrase" placeholder="Enter passphrase" required minlength="4" />
        <button type="submit" id="upload-btn">Upload & Encrypt</button>
    </form>
    <div class="message" id="upload-message"></div>
</section>
  <!-- Right royal vertical line with glowing fleur-de-lis -->
  <div class="royal-side-decor right">
    <svg width="42" height="540" viewBox="0 0 42 540" fill="none" style="display:block;">
      <defs>
        <linearGradient id="side-gold-r" x1="0" y1="0" x2="0" y2="540" gradientUnits="userSpaceOnUse">
          <stop stop-color="#d4af37"/>
          <stop offset="1" stop-color="#bfa177"/>
        </linearGradient>
        <filter id="glow-r" x="-20" y="-20" width="82" height="580" filterUnits="userSpaceOnUse">
          <feGaussianBlur stdDeviation="8" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </defs>
      <rect x="19" y="30" width="4" height="480" rx="2" fill="url(#side-gold-r)" filter="url(#glow-r)"/>
      <text x="21" y="38" text-anchor="middle" font-size="32" fill="#d4af37" filter="url(#glow-r)">&#9884;</text>
      <text x="21" y="502" text-anchor="middle" font-size="32" fill="#d4af37" filter="url(#glow-r)" transform="rotate(180 21 502)">&#9884;</text>
    </svg>
  </div>
  <!-- End right decor -->
        <section id="download-section" class="fade-in">
            <div class="vintage-badge" style="font-size:1.3rem;margin-bottom:1em;">DOWNLOAD & DECRYPT</div>
            <label for="file-list">Available Files:</label>
            <select id="file-list">
                <option value="" disabled selected>Loading files...</option>
            </select>
            <label for="download-passphrase">Passphrase (used to decrypt file):</label>
            <input type="password" id="download-passphrase" placeholder="Enter passphrase" required minlength="4" />
            <button id="download-btn" disabled>Download & Decrypt</button>
            <div class="message" id="download-message"></div>
        </section>
    </main>
      <!-- Centered, straight royal divider with fleur-de-lis -->
      <div class="royal-divider fade-in" aria-hidden="true">
        <svg width="420" height="32" viewBox="0 0 420 32" fill="none">
          <defs>
            <linearGradient id="gold-gradient" x1="0" y1="0" x2="420" y2="0" gradientUnits="userSpaceOnUse">
              <stop stop-color="#d4af37"/>
              <stop offset="1" stop-color="#bfa177"/>
            </linearGradient>
          </defs>
          <line x1="30" y1="16" x2="190" y2="16" stroke="url(#gold-gradient)" stroke-width="4" stroke-linecap="round"/>
          <line x1="230" y1="16" x2="390" y2="16" stroke="url(#gold-gradient)" stroke-width="4" stroke-linecap="round"/>
          <circle cx="210" cy="16" r="12" fill="#fffbe9" stroke="url(#gold-gradient)" stroke-width="3"/>
          <text x="210" y="22" text-anchor="middle" font-size="22" fill="#d4af37" style="filter: drop-shadow(0 2px 4px #bfa17788);">&#9884;</text>
          <circle cx="200" cy="16" r="2.5" fill="#d4af37"/>
          <circle cx="220" cy="16" r="2.5" fill="#d4af37"/>
        </svg>
      </div>
      <footer class="fade-in">MADE WITH LOVE BY TEAM <span style="font-family:'Playfair Display',serif;">CRYPTXFER</span> <span class="royal-symbol" title="Royal Fleur-de-lis">&#9884;</span></footer>

<!-- Modal Popup for Success -->
<div id="modal-popup" class="modal">
  <div class="modal-content">
    <button class="modal-close" onclick="document.getElementById('modal-popup').classList.remove('active')">&times;</button>
    <div id="modal-message">Success!</div>
  </div>
</div>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
      // Theme toggle logic
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');
      function setTheme(dark) {
        document.body.classList.toggle('dark-theme', dark);
        themeIcon.textContent = dark ? '\u263E' : '\u263C'; // Moon/Sun
        localStorage.setItem('cryptxfer-theme', dark ? 'dark' : 'light');
      }
      // Initial
      const storedTheme = localStorage.getItem('cryptxfer-theme');
      if(storedTheme === 'dark') setTheme(true);
      themeToggle.addEventListener('click', () => {
        setTheme(!document.body.classList.contains('dark-theme'));
      });

      // Music autoplay and random looping
      const audio = document.getElementById('bg-music');
      const musicIcon = document.getElementById('music-icon');
      const musicToggle = document.getElementById('music-toggle');
      let musicFiles = [];
      let shuffledPlaylist = [];
      let playing = false;
      let currentTrack = -1;
      let playlistIndex = -1; // index in shuffledPlaylist

      // Fetch all music files from backend
      async function loadMusicFiles() {
        try {
          const res = await fetch('/music-files');
          const files = await res.json();
          musicFiles = Array.isArray(files) ? files : [];
        } catch {
          musicFiles = [];
        }
        // Disable music controls if no music available
        if (musicFiles.length === 0) {
          musicToggle.disabled = true;
          document.getElementById('next-track-btn').disabled = true;
          musicIcon.textContent = '\uD83D\uDD07';
        } else {
          musicToggle.disabled = false;
          document.getElementById('next-track-btn').disabled = false;
        }
      }

      //shuffle
      function shuffle(array) {
        let arr = array.slice();
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function resetPlaylist() {
        shuffledPlaylist = shuffle(musicFiles);
        playlistIndex = 0;
      }

      function playNextTrack() {
        if (!shuffledPlaylist.length) return;
        if (playlistIndex < 0 || playlistIndex >= shuffledPlaylist.length) {
          resetPlaylist();
        }
        audio.src = shuffledPlaylist[playlistIndex];
        currentTrack = musicFiles.indexOf(shuffledPlaylist[playlistIndex]);
        playlistIndex++;
        audio.play().catch(() => {
          musicIcon.textContent = '\uD83D\uDD07'; // muted icon
        });
      }

      function playRandomTrack() {
        // For compatibility with existing code
        playNextTrack();
      }

      // On track end, play next in shuffled playlist
      audio.addEventListener('ended', () => {
        playNextTrack();
      });
      // Toggle music
      musicToggle.addEventListener('click', () => {
        if (audio.paused) {
          audio.play();
          musicIcon.textContent = '\uD83C\uDFB5'; // music note
        } else {
          audio.pause();
          musicIcon.textContent = '\uD83D\uDD07'; // muted icon
        }
      });
      // Next track button logic
      document.getElementById('next-track-btn').addEventListener('click', () => {
        playNextTrack();
      });
      // On load, fetch music files and start shuffled playlist
      window.addEventListener('DOMContentLoaded', async () => {
        await loadMusicFiles();
        resetPlaylist();
        playNextTrack();
      });
      // On play, update icon
      audio.addEventListener('play', () => {
        playing = true;
        musicIcon.textContent = '\uD83C\uDFB5';
      });
      audio.addEventListener('pause', () => {
        playing = false;
        musicIcon.textContent = '\uD83D\uDD07';
      });
    </script>
</body>
</html>
